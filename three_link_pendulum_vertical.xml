<mujoco model="three_link_pendulum_vertical">
  <compiler angle="radian" coordinate="local" inertiafromgeom="false"/>
  <!-- Enable gravity for a true pendulum -->
  <option gravity="0 0 -9.81"/>

  <visual>
    <quality shadowsize="4096" offsamples="16"/>
    <map znear="0.002" zfar="50" fogstart="8" fogend="20"/>
  </visual>

  <asset>
    <!-- Skybox -->
    <texture name="skybox" type="skybox" builtin="gradient"
             rgb1="0.70 0.80 0.95" rgb2="0.05 0.08 0.15" width="512" height="512"/>

    <!-- Floor checkerboard: darker colors, reduced reflection and highlights -->
    <texture name="grid" type="2d" builtin="checker" width="1024" height="1024"
             rgb1="0.36 0.36 0.37" rgb2="0.28 0.28 0.29" mark="edge" markrgb="0.20 0.20 0.20"/>
    <material name="mat_floor" texture="grid" texrepeat="6 6" texuniform="true"
              reflectance="0.1" specular="0.2" shininess="0.15"/>

    <!-- Link materials -->
    <material name="link_red"   rgba="0.90 0.10 0.10 1" specular="0.5" shininess="0.35" reflectance="0.2"/>
    <material name="link_blue"  rgba="0.10 0.10 0.90 1" specular="0.5" shininess="0.35" reflectance="0.2"/>
    <material name="link_green" rgba="0.10 0.85 0.20 1" specular="0.5" shininess="0.35" reflectance="0.2"/>

    <material name="tip_mat" rgba="0.98 0.90 0.15 1" emission="0.3" specular="0.2" shininess="0.3"/>
  </asset>

  <worldbody>
    <!-- Softer lights: lower diffuse/specular to reduce floor glare -->
    <light name="sun" directional="true" castshadow="true"
           diffuse="0.85 0.85 0.85" specular="0.15 0.15 0.15"
           pos="0 0 10" dir="0 0 -1"/>
    <light name="fill" directional="false" castshadow="false"
           diffuse="0.35 0.35 0.35" specular="0.05 0.05 0.05"
           pos="3 -3 2"/>

    <geom type="plane" size="4 4 0.01" material="mat_floor" pos="0 0 -0.1"/>

    <!-- Cameras -->
    <camera name="iso"  pos="3 -3 3.5" euler="0 -0.7 2.2" fovy="45"/>
    <camera name="side" pos="3 0 2.5"  euler="0 -0.2 3.1416" fovy="40"/>

    <!-- Triple pendulum in the xz-plane; joint clearance c=0.02 m -->
    <!-- Link lengths: L1 = 1.20 m (red, top), L2 = 1.20 m (blue, middle), L3 = 0.80 m (green, bottom) -->
    <!-- All three links are coplanar in xz; each joint rotates about +y so motion is planar -->
    <body name="link1_body" pos="0 0 3.8">
      <!-- CoM at -L1/2 along local z (downward) -->
      <inertial mass="1.4" pos="0 0 -0.60" fullinertia="1.3 1.3 0.12 0 0 0"/>
      <!-- Hinge about +y; 0 rad = hanging straight down -->
      <joint name="joint1" type="hinge" axis="0 1 0" pos="0 0 0"/>

      <!-- Collision: spans from -c to -L1; half=(L1-c)/2=0.59, center=-(L1+c)/2=-0.61 -->
      <geom name="link1_coll" type="box" size="0.05 0.05 0.59" pos="0 0 -0.61" rgba="1 0 0 0"/>

      <!-- Visualization: rod & joint caps (render-only) -->
      <geom name="link1_vis" type="capsule" fromto="0 0 -0.02  0 0 -1.20" size="0.05"
            material="link_red" contype="0" conaffinity="0"/>
      <geom name="pin1_vis" type="cylinder" pos="0 0 0" size="0.07 0.02"
            material="link_red" contype="0" conaffinity="0"/>
      <geom name="pin1_tip_vis" type="cylinder" pos="0 0 -1.20" size="0.06 0.018"
            material="link_red" contype="0" conaffinity="0"/>

      <body name="link2_body" pos="0 0 -1.20">
        <inertial mass="1.0" pos="0 0 -0.60" fullinertia="1.1 1.1 0.11 0 0 0"/>
        <joint name="joint2" type="hinge" axis="0 1 0" pos="0 0 0"/>

        <!-- Collision: L2 same as L1 -->
        <geom name="link2_coll" type="box" size="0.05 0.05 0.59" pos="0 0 -0.61" rgba="0 0 1 0"/>

        <!-- Visualization: blue -->
        <geom name="link2_vis" type="capsule" fromto="0 0 -0.02  0 0 -1.20" size="0.05"
              material="link_blue" contype="0" conaffinity="0"/>
        <geom name="pin2_vis" type="cylinder" pos="0 0 0" size="0.07 0.02"
              material="link_blue" contype="0" conaffinity="0"/>
        <geom name="pin2_tip_vis" type="cylinder" pos="0 0 -1.20" size="0.06 0.018"
              material="link_blue" contype="0" conaffinity="0"/>

        <body name="link3_body" pos="0 0 -1.20">
          <!-- CHANGED: mass ↑ to 0.9 kg, length L3 ↑ to 0.90 m, COM to -0.45 -->
          <inertial mass="0.9" pos="0 0 -0.45" fullinertia="0.6 0.6 0.06 0 0 0"/>
          <joint name="joint3" type="hinge" axis="0 1 0" pos="0 0 0"/>

          <!-- Third link L3=0.80; half=(L3-c)/2=0.39, center=-(L3+c)/2=-0.41 -->
          <geom name="link3_coll" type="box" size="0.05 0.05 0.44" pos="0 0 -0.46" rgba="0 1 0 0"/>

          <!-- Visualization: green (bottom) -->
          <geom name="link3_vis" type="capsule" fromto="0 0 -0.02  0 0 -0.90" size="0.05"
                material="link_green" contype="0" conaffinity="0"/>
          <geom name="pin3_vis" type="cylinder" pos="0 0 0" size="0.06 0.018"
                material="link_green" contype="0" conaffinity="0"/>

          <site name="tip" pos="0 0 -0.90" size="0.0001" material="tip_mat"/>
        </body>
      </body>
    </body>
  </worldbody>

  <sensor>
    <!-- Joint positions and velocities -->
    <jointpos joint="joint1"/>
    <jointpos joint="joint2"/>
    <jointpos joint="joint3"/>

    <jointvel joint="joint1"/>
    <jointvel joint="joint2"/>
    <jointvel joint="joint3"/>

    <!-- Actuator torques -->
    <actuatorfrc actuator="m1"/>
    <actuatorfrc actuator="m2"/>
    <actuatorfrc actuator="m3"/>

    <!-- Tip Cartesian position -->
    <framepos objtype="site" objname="tip"/>
  </sensor>

  <actuator>
    <motor name="m1" joint="joint1" gear="1"/>
    <motor name="m2" joint="joint2" gear="1"/>
    <motor name="m3" joint="joint3" gear="1"/>
  </actuator>

  <keyframe>
    <!-- Home pose: all q = 0 rad -> straight down -->
    <key name="home_down" qpos="0 0 0" ctrl="0 0 0"/>
  </keyframe>
</mujoco>

